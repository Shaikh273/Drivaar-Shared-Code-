
!function($) {
    "use strict";

    var CalendarApp = function() {
        this.$body = $("body"),
        this.$calendar = $('#calendar')
    };
    var CalendarApp1 = function() {
        this.$body = $("body"),
        this.$calendar = $('#calendar1')
    };

    /* on drop */
    // CalendarApp.prototype.onDrop = function (eventObj, date) { 
        
    // },
    /* on click on event */
    CalendarApp.prototype.onEventClick =  function (calEvent, jsEvent, view) {
        var $this = this;
            var form = $("<form></form>");
            form.append("<label>Change event name</label>");
            form.append("<div class='input-group'><input class='form-control' type=text value='" + calEvent.title + "' /><span class='input-group-btn'><button type='submit' class='btn btn-success waves-effect waves-light'><i class='fa fa-check'></i> Save</button></span></div>");
            // $this.$modal.modal({
            //     backdrop: 'static'
            // });
            $this.$modal.find('.delete-event').show().end().find('.save-event').hide().end().find('.modal-body').empty().prepend(form).end().find('.delete-event').unbind('click').click(function () {
                $this.$calendarObj.fullCalendar('removeEvents', function (ev) {
                    return (ev._id == calEvent._id);
                });
                $this.$modal.modal('hide');
            });
            $this.$modal.find('form').on('submit', function () {
                calEvent.title = form.find("input[type=text]").val();
                $this.$calendarObj.fullCalendar('updateEvent', calEvent);
                $this.$modal.modal('hide');
                return false;
            });
    },
    CalendarApp1.prototype.onEventClick =  function (calEvent, jsEvent, view) {
            var $this = this;
            var form = $("<form></form>");
            form.append("<label>Change event name</label>");
            form.append("<div class='input-group'><input class='form-control' type=text value='" + calEvent.title + "' /><span class='input-group-btn'><button type='submit' class='btn btn-success waves-effect waves-light'><i class='fa fa-check'></i> Save</button></span></div>");
            // $this.$modal.modal({
            //     backdrop: 'static'
            // });
            $this.$modal.find('.delete-event').show().end().find('.save-event').hide().end().find('.modal-body').empty().prepend(form).end().find('.delete-event').unbind('click').click(function () {
                $this.$calendarObj.fullCalendar('removeEvents', function (ev) {
                    return (ev._id == calEvent._id);
                });
                $this.$modal.modal('hide');
            });
            $this.$modal.find('form').on('submit', function () {
                calEvent.title = form.find("input[type=text]").val();
                $this.$calendarObj.fullCalendar('updateEvent', calEvent);
                $this.$modal.modal('hide');
                return false;
            });
    },
    /*on select*/
    CalendarApp.prototype.onSelect = function (start, end, allDay) {
         // alert(start);
          var date = new Date(start);
          //var Formated_date = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
          var  week = [];
          var monthNames = ["January", "February", "March", "April", "May", "June",
                              "July", "August", "September", "October", "November", "December"
                           ];
          var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
          var i;
          for (i = 1; i <= 7; i++) 
          {
              var first = date.getDate() - date.getDay() + (i-1); 
              var day = new Date(date.setDate(first)).toISOString().slice(0, 10);
              var Formated_day = date.getDate() + " " + monthNames[date.getMonth()];
              week.push(day);
              $('#day-' + i).html(Formated_day);
              $('#hiddendate-' + i).val(day);
              $('#dayname-' + i).html(days[date.getDay()]);
              showdata(document.getElementById('hiddendate-' + i));
              
          }

          var $this = this;
            $this.$modal.modal({
                backdrop: 'static'
            });
            var form = $("<form></form>");
            form.append("<div class='row'></div>");
            form.find(".row")
                .append("<div class='col-md-6'><div class='form-group'><label class='control-label'>Event Name</label><input class='form-control' placeholder='Insert Event Name' type='text' name='title'/></div></div>")
                .append("<div class='col-md-6'><div class='form-group'><label class='control-label'>Category</label><select class='form-control' name='category'></select></div></div>")
                .find("select[name='category']")
                .append("<option value='bg-danger'>Danger</option>")
                .append("<option value='bg-success'>Success</option>")
                .append("<option value='bg-purple'>Purple</option>")
                .append("<option value='bg-primary'>Primary</option>")
                .append("<option value='bg-pink'>Pink</option>")
                .append("<option value='bg-info'>Info</option>")
                .append("<option value='bg-warning'>Warning</option></div></div>")
                ;
            $this.$modal.find('.delete-event').hide().end().find('.save-event').show().end().find('.modal-body').empty().prepend(form).end().find('.save-event').unbind('click').click(function () {
                form.submit();
            });
            $this.$modal.find('form').on('submit', function () {
                var title = form.find("input[name='title']").val();
                var beginning = form.find("input[name='beginning']").val();
                var ending = form.find("input[name='ending']").val();
                var categoryClass = form.find("select[name='category'] option:checked").val();
                if (title !== null && title.length != 0) {
                    $this.$calendarObj.fullCalendar('renderEvent', {
                        title: title,
                        start:start,
                        end: end,
                        allDay: false,
                        className: categoryClass
                    }, true);  
                    $this.$modal.modal('hide');
                }
                else{
                    alert('You have to give a title to your event');
                }
                return false;
                
            });
            $this.$calendarObj.fullCalendar('unselect');
    },
    CalendarApp1.prototype.onSelect = function (start, end, allDay) {
        
          var date = new Date(start);
          //var Formated_date = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
          var  week = [];
          var monthNames = ["January", "February", "March", "April", "May", "June",
                              "July", "August", "September", "October", "November", "December"
                           ];
          var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
          var i;
          for (i = 1; i <= 7; i++) 
          {
              var first = date.getDate() - date.getDay() + (i-1); 
              var day = new Date(date.setDate(first)).toISOString().slice(0, 10);
              var Formated_day = date.getDate() + " " + monthNames[date.getMonth()];
              week.push(day);
              $('#day-' + i).html(Formated_day);
              $('#hiddendate-' + i).val(day);
              $('#dayname-' + i).html(days[date.getDay()]);
              showdata(document.getElementById('hiddendate-' + i));
              //alert(day);
          }

          var $this = this;
            $this.$modal.modal({
                backdrop: 'static'
            });
            var form = $("<form></form>");
            form.append("<div class='row'></div>");
            form.find(".row")
                .append("<div class='col-md-6'><div class='form-group'><label class='control-label'>Event Name</label><input class='form-control' placeholder='Insert Event Name' type='text' name='title'/></div></div>")
                .append("<div class='col-md-6'><div class='form-group'><label class='control-label'>Category</label><select class='form-control' name='category'></select></div></div>")
                .find("select[name='category']")
                .append("<option value='bg-danger'>Danger</option>")
                .append("<option value='bg-success'>Success</option>")
                .append("<option value='bg-purple'>Purple</option>")
                .append("<option value='bg-primary'>Primary</option>")
                .append("<option value='bg-pink'>Pink</option>")
                .append("<option value='bg-info'>Info</option>")
                .append("<option value='bg-warning'>Warning</option></div></div>")
                ;
            $this.$modal.find('.delete-event').hide().end().find('.save-event').show().end().find('.modal-body').empty().prepend(form).end().find('.save-event').unbind('click').click(function () {
                form.submit();
            });
            $this.$modal.find('form').on('submit', function () {
                var title = form.find("input[name='title']").val();
                var beginning = form.find("input[name='beginning']").val();
                var ending = form.find("input[name='ending']").val();
                var categoryClass = form.find("select[name='category'] option:checked").val();
                if (title !== null && title.length != 0) {
                    $this.$calendarObj.fullCalendar('renderEvent', {
                        title: title,
                        start:start,
                        end: end,
                        allDay: false,
                        className: categoryClass
                    }, true);  
                    $this.$modal.modal('hide');
                }
                else{
                    alert('You have to give a title to your event');
                }
                return false;
                
            });
            $this.$calendarObj.fullCalendar('unselect');
    },

    /* Initializing */
    CalendarApp.prototype.init = function() {
        // this.enableDrag();
        /*Initialize the calendar*/
        //var date = new Date();
        var date1 = '';
        $.ajax({
            type: "POST",
            url: "../../../../home/setTimezone.php",
            async: false, 
            data: {action : 'GetDateFunction'},
            dataType: 'text',
            success: function(data) {
              date1=data;   
            }
        });
        var date = new Date(date1);
        date.setMonth(date.getMonth()-1);
        var d = date.getDate();
        var m = date.getMonth();
        var y = date.getFullYear();
        var form = '';
        var today =new Date(date1);
        today.setDate(1);
        today.setMonth(today.getMonth()-1);

          //var Formated_date = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
        var  week = [];
        var monthNames = ["January", "February", "March", "April", "May", "June",
                              "July", "August", "September", "October", "November", "December"
                           ];
        var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        var i;
        for (i = 1; i <= 7; i++) 
        {
            var first = today.getDate() - today.getDay() + (i-1); 
            var day = new Date(today.setDate(first)).toISOString().slice(0, 10);
            var Formated_day = today.getDate() + " " + monthNames[today.getMonth()];
            week.push(day);
            $('#day-' + i).html(Formated_day);
            $('#hiddendate-' + i).val(day);
            $('#dayname-' + i).html(days[today.getDay()]);
            //alert(day);
        }

        var defaultEvents =  [
            ];
        var $this = this;
        $this.$calendarObj = $this.$calendar.fullCalendar({
            slotDuration: '00:15:00', /* If we want to split day time each 15minutes */
            minTime: '08:00:00',
            maxTime: '19:00:00',  
            defaultView: 'month',  
            handleWindowResize: true,   
            header: {
                right: 'month'
            },
            showNonCurrentDates: false ,
            month:m,
            events: defaultEvents,
            editable: false,
            droppable: false, // this allows things to be dropped onto the calendar !!!
            eventLimit: false, // allow "more" link when too many events
            selectable: true,
            // drop: function(date) { $this.onDrop($(this), date); },
            select: function (start, end, allDay) { $this.onSelect(start, end, allDay); },
            eventClick: function(calEvent, jsEvent, view) { $this.onEventClick(calEvent, jsEvent, view); }
        });
    },
    CalendarApp1.prototype.init = function() {
        // this.enableDrag();
        /*Initialize the calendar*/
        //var date = new Date();
        var date1 = '';
        $.ajax({
            type: "POST",
            url: "../../../../home/setTimezone.php",
            async: false, 
            data: {action : 'GetDateFunction'},
            dataType: 'text',
            success: function(data) {
              date1=data;   
            }
        });
        var date = new Date(date1);
        var d = date.getDate();
        var m = date.getMonth();
        var y = date.getFullYear();
        var form = '';
        var today = new Date($.now());
        //var Formated_date = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
        var  week = [];
        var monthNames = ["January", "February", "March", "April", "May", "June",
                              "July", "August", "September", "October", "November", "December"
                           ];
        var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        var i;
        for (i = 1; i <= 7; i++) 
        {
            var first = today.getDate() - today.getDay() + (i-1); 
            var day = new Date(today.setDate(first)).toISOString().slice(0, 10);
            var Formated_day = today.getDate() + " " + monthNames[today.getMonth()];
            week.push(day);
            $('#day-' + i).html(Formated_day);
            $('#hiddendate-' + i).val(day);
            $('#dayname-' + i).html(days[today.getDay()]);
            //alert(day);
        }
        var defaultEvents =  [
            ];
        var $this = this;
        $this.$calendarObj = $this.$calendar.fullCalendar({
            slotDuration: '00:15:00', /* If we want to split day time each 15minutes */
            minTime: '08:00:00',
            maxTime: '19:00:00',  
            defaultView: 'month',  
            handleWindowResize: true,   
            header: {
                right: 'month'
            },
            events: defaultEvents,
            showNonCurrentDates: false,
            editable: false,
            droppable: false, // this allows things to be dropped onto the calendar !!!
            eventLimit: false, // allow "more" link when too many events
            selectable: true,
            // drop: function(date) { $this.onDrop($(this), date); },
            select: function (start, end, allDay) { $this.onSelect(start, end, allDay); },
            eventClick: function(calEvent, jsEvent, view) { $this.onEventClick(calEvent, jsEvent, view); }
        });
    },
   //init CalendarApp
    $.CalendarApp = new CalendarApp, 
    $.CalendarApp.Constructor = CalendarApp
    $.CalendarApp1 = new CalendarApp1, 
    $.CalendarApp1.Constructor = CalendarApp1
    
}(window.jQuery),
//initializing CalendarApp
function($) {
    "use strict";
    $.CalendarApp.init()
    $.CalendarApp1.init()
}(window.jQuery);